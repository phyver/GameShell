GameShell
=========

TODO NOW
--------

  - [ ] doc


  - [ ] check comments generated by `new-missions.sh`

  - [x] use `LC_ALL` instead of `LANGUAGE`, which is not supported everywhere
  - [x] remove test / question when running GameShell in the developpment dir
  - [x] randomize uid even in anonymous / debug mode
  - [x] add tests to check `os_common.sh` functions are working
  - [x] add `GSH_SBIN` to the path while sourcing mission files
  - [x] add a password for `gsh protect / unprotect`
  - [x] for processes in processes group, the shebang needs to be changed
        depending on the path to the interpreter
        in freebsd, the process name isn't taken from argv[0] but contains the
        interpreter name
  - [x] make the treasure messages stand out more (use some ASCII treasure
    chest?)
  - [x] `ls --literal` doesn't exist in freebsd
  - [x] giving missions to `start.sh` doesn't work outside `$GSH_ROOT`
  - [x] `date` doesn't have the same argument in freebsd (mission nostradamus)
  - [x] generate `.mo` if `.po` is newer
  - [x] crown not found
  - [x] `sed -i` doesn't have the same meaning in gnu / bsd
  - [x] `ls --color=auto` may not work
  - [x] inventory and grimoire: `tr` in freebsd doesn't accept binary
  - [x] move `checksum` to os_aliases.sh
  - [x] clean `lib` folder ?
  - [x] add specific functions for missions: `make_bin`, `sign_file`,
    `check_file`, `progress`
  - [x] put back progress bar on startup (possibly doing something nice)???
  - [x] try to make sure pager handles colors correctly
  - [x] use pager on gsh index


FOR LATER
---------

  - [ ] explore benefits (if any) of `set -e` when sourcing missions scripts

  - [ ] save seed from `random_string` / `RANDOM` for better PRNG if PID
        doesn't change

  - [ ] merge `deps.sh` into `init.sh`

  - [ ] finish converting `common.sh` to scripts in `bin`

  - [ ] `mktemp` script

  - [ ] replace all script which have to `unset` several variables to
        functions with local variables

  - [ ] change `progress_bar` interface to `progress_bar CMD`? That should
        make it possible to store error messages in display them at the end,
        and get a uniform delay between updates. (No read necessary: we
        display the animation and stop when `CMD` stops.)

  - [ ] `error` function for `echo "$@" >&2`

  - [ ] minimize number of bashism's? (not sure if it is worth trying to be
        POSIX compliant though)
          - `$RANDOM` => use `awk` function `rand`
          - `source` => `.`
          - `echo -n` => `printf`
          - `read -p` => `printf` + `read`
          - `read -s` => `stty -echo` + `read` + `stty echo`
          - `$'...'` string => ???
          - `OSTYPE` => probably not useful if we reach for full POSIX
          - `local` variables => ??? (cf
            htps://stackoverflow.com/questions/18597697/posix-compliant-way-to-scope-variables-to-a-function-in-a-shell-script)
          - `export -f` => put exported functions into separate files
          - `compgen` => `set` ? `env` for variables, but not sure about functions

          - `head -c` - `tail -c` => `dd` ???
          - `head ... -N` => ???
          - `tail ... +N` => ???
          - `seq` => while loop
          - `mktemp` => write our own
          - `xargs -0` / `find ... -print0` => assume no newline in file names
          - `gettext` => `printf`
          - `eval_gettext` => `eval` + `gettext`
          - `sleep 0.1`
          - `realpath` / `readlink` => see https://github.com/ko1nksm/readlinkf/blob/master/readlinkf.sh
          - https://stackoverflow.com/questions/7665/how-to-resolve-symbolic-links-in-a-shell-script

  - [ ] should `gsh` commands return error codes ?
        That could be useful for `gsh check`, but since it is automatically
        followed by the initialisation of the next (or same) missions, that
        could be confusing
        Idea:
               `check.sh` => least significant bit
               `test.sh` => bit 1
               `init.sh` / `deps.sh` => bit 2
               `static.sh` => bit 3
               `goal.sh` / `auto.sh` => bit 4
               `treasure.sh` => bit 5
               `treasure-msg.sh` => bit 6

  - [ ] `gsh config` command to configure some options
         - verbose option (debug only)
         - ansi colors
         - quiet
         - pager
         - no box option

  - [ ] `gsh reset static` command

  - [ ] external `stats` commands (using awk?) for
       - `gsh stats sessions`
       - `gsh stats missions`
       - `gsh stats mission N`

  - [ ] make a copy of `$GSH_CHEST` at each mission to restore it in case of
        problem?

  - [ ] think again about using `ttyrec` and `ttyreplay`?

  - [ ] allow configuration of titlescreen and list of boxes

  - [ ] I like the idea of having a `gsh` file that is executed for the
        command `gsh`, but this means `gsh` takes place in a subshell, where
        it doesn't have access to user defined functions or aliases.


Existing missions
=================

TODO NOW
--------

  - [ ] mission alias journal: have the player add the alias to
        $GSH_CHEST/bashrc?

  - [ ] use "gsh" instead of "pq" for the corresponding mission
  - [ ] rephrase goal in merlin's mission

  - [ ] change the `\"DUMMY_MISSION\"` messages
  - [ ] check for spaces in `$nb_spiders` messages

  - [ ] awk version of genStall.py

  - [ ] use `progress_bar` in missions using `maze2.sh`
        that requires changing a little its interface because it is currently
        writing progress on STDERR and printing directories on STDOUT

  - [x] simplify FINAL mission by just give a new password and let the player
        do what she wants

  - [x] `treasure.sh`: macos `ls` doesn't use `--color` but `-G`
  - [x] add hint in mission
        `stdin_stdout_stderr/05_stdout_stderr_redirection_merlin` to explain
        the key needs to be given by a file redirection
  - [x] check all group with shared data have appropriate `deps.sh`
  - [x] in mission `misc/tr_caesar_shift`, make the chest appear in Merlin's
        office. Add a few thinks in the chest as well.
  - [x] `merchant_stall/pipe_2`: the prompt is not reset correctly
  - [x] do not count `gsh` commands in `pipes_merchant_stall/pipe_1`
  - [x] make sure there are at least a few grimoires with `pq` in stdin_stdout_stderr/stderr_dev-null_grimoires
  - [x] split mission `basic/rm_wildcard_spiders_cellar` in 2: first a lot of
    spiders to introduce wildcards, and then a lot of hidden spiders to
    introduce wildcards on hidden files
  - [x] put some ascii-art in different places:
          - [x] Merlin drawer?
          - [x] the observatory?
          - [x] Shed / Orchard?
          - [x] cellar?
  - [x] move missions 6 and 7 to the Garden
  - [x] change last mission in group "book_of_potions"
  - [x] change entrance to "great hall"
  - [x] translate "book_of_potions"
  - [x] mission 9: add other items to prevent using `cp *`
  - [x] mission 15: add a treasure to source `$GSH_CHEST/bashrc`, and suggest
        adding aliases like `gg => gsh goal` and `gc => gsh check`
  - [x] 28: mention `ls FILES` / `ls PATTERN`
  - [x] mission 24: change
  - [x] mission 25: change
  - [x] finish the hierarchy for missions
  - [x] rename all missions to have more informative names, eg
        `basic/01_cd_tower` and similar
  - [x] translate merlin.c / merlin.py in mission 30 cf
        https://mohan43u.wordpress.com/2012/07/02/gnu-gettext-yet-another-tutorial/


FOR LATER
---------

  - create `c` files for processes in processes group. That way, we can get
    "real" processes with "good" names on all platform that have a c compiler

  - for missions that generate many files, remove most of them in `clean.sh`

  - merchant stall: clean python code for initialization

  - in missions re-evaluating the previous command, run it with timeout (if available).

  - mission 14: allow using another editor if `$EDITOR` is set

  - some `test.sh`: don't use ranges in `history -d ...` because older
    versions of bash do not support it.
    (apparently, macos doesn't support it)

  - make sure all missions have a `test.sh`, and that it works in English and
    French

  - what's the deal with redirecting `fc -nl` changing the last command in
    history?


Some missions ideas
===================


  - using `ls -l` and some other common options

  - `ls *`   vs  `ls -d *`

  - using `less` / `more` to paginate output of a command

  - `PATH` variable

  - symbolic links ("make a secret passage from one room to another"?)

  - using `sort` / `uniq`

  - search through the history with `C-r`

  - history of commands

  - more missions using shell patterns `[...]` and `[^...]` (or `[!...]` as
    specified by POSIX, but this interacts with bash' history expansion)

  - mission using `*/*` patterns to explain that `/` are not captured by
    wildcards

  - something with regular expressions and `grep`

  - create empty files with `touch`, update modification date

  - scripting: `for` loops on files

  - `pushd` / `popd`

  - `comm` to compare before / after file

  - `paste` to "restore" a torn treasure map

  - `join`

  - `wget` / `curl`

  - `tar` / `zip`
    - Idea: receive/send a package (archive = packaging).

  - `fuser` / `lsof`

  - print prime numbers less than N with a combination of `seq` / `factor` /
    `grep` / `cut`

  - only activate completion once the first appropriate mission has been
    completed
    (put `bind 'set disable-completion' on` in the first mission's `bashrc`,
    and `bind ... of` in some mission' `treasuse.sh`)

  - "summary missions" to practice what has been learnt at the end of the
    `missions/basic` mission group. We could ask the player o tidy up the
    pantry, initially filled with a big mess of files (fruits, cheese, meat,
    wine, trash, ...) and the player would have to organise everything into
    a specified directory structure: fruits in "barrels", cheese on "shelves",
    get rid of trash, ...

  - manage an inventory (or the `Chest`) with aliases:
    - `alias inventory='ls ~/Forest/Hut/Chest | nl` to show the inventory,
    - `alias pick='mv -t ~/Forest/Hut/Chest` to pick an item (NOTE: it
      probably requires GNU's `mv` with option `-t`)
    - `alias drop='...'` to drop an item at the current location (NOTE: that's
      probably better to use a function for that, no?)
